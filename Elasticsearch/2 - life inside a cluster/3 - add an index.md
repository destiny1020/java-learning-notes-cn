## 添加索引 ##

为了向ES中添加数据，我们需要一个索引(Index) - 它是一个用来存储相关数据的地方。实际上，一个索引实际上只是一个"逻辑命名空间(Logical Namespace)"，用来指向一个或者多个物理分片(Physical Shard)。

一个分片就是底层的"工作单元(Worker Unit)"，它拥有索引中所有数据的一部分。在[分片](http://www.elasticsearch.org/guide/en/elasticsearch/guide/current/inside-a-shard.html)一章中，会对分片的工作方式进行详细说明，但是就现在而言，我们只需要知道一个分片就是一个Lucene的实例，一个分片本身就是一个完整的搜索引擎。我们的文档会被存储和索引在分片中，但是应用是不会直接和分片进行交互的。相反地，应用和索引进行交互。

ES通过分片将数据分布在集群中。可以将分片想象成数据的容器。文档会被存储在分片中，而分片则会被分配到集群中的节点中。随着集群的扩大和虽小，ES会自动地将分片在节点之间进行迁移，以保证集群能够保持一种平衡。

一个分片可以是主分片(Primary Shard)或者副本分片(Replica Shard)。索引中的每份文档都属于一个主分片，所以主分片的数量就决定了你的索引能够存储的最大数据量。

> 尽管在理论上，一个主分片能够容纳的最大数据量并没有限制，但是在实际生产中这个限制是存在的。分片的最大空间完全取决于你的用例：硬件条件，文档的大小和复杂度，如何索引和查询文档，以及期望的响应时间。

一个副本分片则只是一个主分片的拷贝。副本用来提供数据冗余，用来保护数据在发生硬件故障是不会丢失，同时也能够处理像搜索和获取文档这样的读请求。

主分片的数量在索引建立之初就会被确定下来，而副本分片的数量则可以在任何时候被更改。

让我们在当前只有一个节点的集群中创建一个新的blogs索引。默认情况下，索引会拥有5个主分片，但是为了演示，我们会让索引有3个主分片和1个副本分片(每个主分片都有1个副本分片)：

```
PUT /blogs
{
   "settings" : {
      "number_of_shards" : 3,
      "number_of_replicas" : 1
   }
}
```

此时我们的集群就变成这样了：

![](http://www.elasticsearch.org/guide/en/elasticsearch/guide/current/images/02-02_one_node.png)

这个时候我们如果检查集群的健康状态，会得到如下的结果：

```
{
   "cluster_name":          "elasticsearch",
   "status":                "yellow", 
   "timed_out":             false,
   "number_of_nodes":       1,
   "number_of_data_nodes":  1,
   "active_primary_shards": 3,
   "active_shards":         3,
   "relocating_shards":     0,
   "initializing_shards":   0,
   "unassigned_shards":     3 
}
```

集群的健康状态变成了黄色，同时响应中还说明了有3个未被分配的分片。

黄色说明了所有的主分片都正在正常运行，处于活动状态 - 集群现在能够成功处理来自外部的请求 - 但是并不是所有的副本分片都处于活动状态。实际上，所有的3个副本分片目前都处于"未分配"的状态 - 它们不存在于任何节点上。这是因为将相同数据的拷贝存放在同一节点上是没有意义的。如果我们失去了该节点，那么我们会失去所有数据和它们的拷贝。

因此当前我们的集群能够正常工作，只不过抵御不了硬件故障带来的风险。



