## 水平扩展(Scale Horizontally) ##

随着应用的扩展，ES如何对集群进行扩展呢？如果我们启动了第三个节点，那么集群可能会像如下所示的那样重新组织自身的结构：

![](http://www.elasticsearch.org/guide/en/elasticsearch/guide/current/images/02-04_three_nodes.png)

节点1和节点2中各有一个分片现在被移动到了新的节点3中，此时每个节点上都有2个分片，而不是原来的3个。这意味着每个节点上的硬件资源(CPU，RAM，I/O)能够被更少的分片所享有，从而提高每个分片的性能。

每个分片本身就是一个完整的搜索引擎，它能够完全地利用一个节点上的所有资源。因此，在拥有6个分片(3主，3副本)的情况下，我们的集群最多可以扩展到6个节点，此时每个节点上只有1个分片，因此每个分片就能够拥有该节点100%的资源。

### 如果继续扩展 ###

如果我们想扩展到多于6个节点呢？

在建立索引的时候，主分片的数量就被固定下来了。实际上，这个数量决定了该索引中能够**存储**的最大数据量。(实际数量取决于你的数据特征和你的硬件)。但是，对于读请求 - 搜索或者获取文档 - 能够被主分片**或者**副本分片处理，因此当数据有越多的副本，也就意味着搜索的吞吐量能够更高。

副本分片的数量能够在一个活动的集群上动态修改，这就允许我们能够根据需要进行集群规模的调整。让我们将当前的副本分片数量从1调整到2：

```
PUT /blogs/_settings
{
   "number_of_replicas" : 2
}
```

调整后的组织如下所示：

![](http://www.elasticsearch.org/guide/en/elasticsearch/guide/current/images/02-05_replicas.png)

现在blogs索引中就存在9个分片了：3个主分片和6个副本分片。这意味着现在我们可以最多扩展到9个节点，每个节点中只有一个分片。这能够让搜索性能相比原来的3个节点，提升**3倍**。

**NOTE**
当然，仅增加副本分片的数量而不增加节点的数量是不会对性能有任何提高的。这是因为在该情况下，每个分片只会得到其所在节点的一部分资源。你需要增加硬件资源来提高吞吐量。

但是这些新添加的副本无疑增加了数据的冗余：像上图那样配置的话，我们现在能够做到即便丢失了两个节点也不会丢失数据。




